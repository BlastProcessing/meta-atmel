From 7c62c5810945b1fb52f0caad6b0e3f927b7e0477 Mon Sep 17 00:00:00 2001
From: Ulf Samuelsson <ulf_samuelsson@telia.com>
Date: Fri, 28 Oct 2011 12:41:31 +0200
Subject: [PATCH 32/39] Update WinCE build ffiles for _2mmc

---
 driver/sources                  |   12 +++-
 wince/buildscripts/clean.bat    |    3 +-
 wince/buildscripts/subbuild.bat |  149 ++++++++++++++++++++++++++++++++++++++-
 wince/image/sources             |   10 +++
 4 files changed, 171 insertions(+), 3 deletions(-)

diff --git a/driver/sources b/driver/sources
index 9997b3c..d17f3e2 100644
--- a/driver/sources
+++ b/driver/sources
@@ -64,6 +64,15 @@ CDEFINES=$(CDEFINES) -DGLBDRV_ADDR=0x20058000
 CDEFINES=$(CDEFINES) -DAT91SAM9G20
 !ENDIF
 
+!IF ("$(CONFIG_AT91SAM9G20EK_2MMC)" == "Y")
+CDEFINES=$(CDEFINES) -DCONFIG_AT91SAM9G20EK_2MMC
+CDEFINES=$(CDEFINES) -DCONFIG_SDRAM
+CDEFINES=$(CDEFINES) -DGLBDRV_ADDR=0x20058000
+!ENDIF
+!IF ("$(AT91SAM9G20_2MMC)" == "Y")
+CDEFINES=$(CDEFINES) -DAT91SAM9G20
+!ENDIF
+
 !IF ("$(CONFIG_AT91SAM9G45EK)" == "Y")
 CDEFINES=$(CDEFINES) -DCONFIG_AT91SAM9G45EK
 CDEFINES=$(CDEFINES) -DCONFIG_DDR2
@@ -181,6 +190,7 @@ INCLUDES=..\include; \
          ..\board\at91sam9rlek; \
          ..\board\at91sam9g10ek; \
          ..\board\at91sam9g20ek; \
+         ..\board\at91sam9g20ek_2mmc; \
          ..\board\at91sam9g45ek; \
          ..\board\at91sam9m10ek; \
          ..\board\at91sam9g45ekes; \
@@ -209,4 +219,4 @@ SOURCES= \
     dma.c \
     pio.c \
     linux_loader.c \
-    wince_loader.c \
\ No newline at end of file
+    wince_loader.c \
diff --git a/wince/buildscripts/clean.bat b/wince/buildscripts/clean.bat
index caefd2b..aeca14b 100644
--- a/wince/buildscripts/clean.bat
+++ b/wince/buildscripts/clean.bat
@@ -3,6 +3,7 @@ set STACK_CHECK_DISABLE=
 
 set CONFIG_AT91SAM9G10EK=
 set AT91SAM9G10=
+set CONFIG_AT91SAM9G20EK_2MMC=
 set CONFIG_AT91SAM9G20EK=
 set AT91SAM9G20=
 set CONFIG_AT91SAM9G45EK=
@@ -40,4 +41,4 @@ set CONFIG_CPU_CLK_240MHZ=
 set CONFIG_CPU_CLK_250MHZ=
 set CONFIG_CPU_CLK_266MHZ=
 set CONFIG_CRYSTAL_16_36766MHZ=
-set CONFIG_CRYSTAL_18_432MHZ=
\ No newline at end of file
+set CONFIG_CRYSTAL_18_432MHZ=
diff --git a/wince/buildscripts/subbuild.bat b/wince/buildscripts/subbuild.bat
index 9f442ac..c163e0d 100644
--- a/wince/buildscripts/subbuild.bat
+++ b/wince/buildscripts/subbuild.bat
@@ -885,6 +885,153 @@ set CONFIG_SDCARD=Y
 set JUMP_ADDR=0x20000000
 goto :build
 
+:9g20_2mmc_dataflash_eboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_DATAFLASH=Y
+set JUMP_ADDR=0x20000000
+set IMG_ADDRESS=0x5000
+set IMG_SIZE=0x40000
+set CONFIG_LOAD_EBOOT=Y
+goto :build
+
+:9g20_2mmc_dataflash_cekernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_DATAFLASH=Y
+set JUMP_ADDR=0x20000000
+set IMG_ADDRESS=0x5000
+set IMG_SIZE=0x20000
+set CONFIG_LOAD_NK=Y
+goto :build
+
+:9g20_2mmc_dataflash_uboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_DATAFLASH=Y
+set JUMP_ADDR=0x23F00000
+set IMG_ADDRESS=0x8400
+set IMG_SIZE=0x40000
+set CONFIG_LOAD_UBOOT=Y
+goto :build
+
+:9g20_2mmc_dataflash_linuxkernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_DATAFLASH=Y
+set JUMP_ADDR=0x22000000
+set IMG_ADDRESS=0x42000
+set IMG_SIZE=0x200000
+set CONFIG_LOAD_LINUX=Y
+set OS_MEM_BANK=0x20000000
+set OS_MEM_SIZE=0x4000000
+set MACH_TYPE=0x658
+goto :build
+
+:9g20_2mmc_dataflash_gettingstarted
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_DATAFLASH=Y
+set JUMP_ADDR=0x20000000
+set IMG_ADDRESS=0x8400
+set IMG_SIZE=0x40000
+goto :build
+
+:9g20_2mmc_nandflash_eboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_NANDFLASH=Y
+set JUMP_ADDR=0x20000000
+
+set IMG_ADDRESS=0x80000
+set IMG_SIZE=0x40000
+set CONFIG_LOAD_EBOOT=Y
+goto :build
+
+:9g20_2mmc_nandflash_cekernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_NANDFLASH=Y
+set JUMP_ADDR=0x20067000
+set IMG_ADDRESS=0x200000
+set IMG_SIZE=0x2000000
+set CONFIG_LOAD_NK=Y
+goto :build
+
+:9g20_2mmc_nandflash_uboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_NANDFLASH=Y
+set JUMP_ADDR=0x23F00000
+set IMG_ADDRESS=0x20000
+set IMG_SIZE=0x40000
+set CONFIG_LOAD_UBOOT=Y
+goto :build
+
+:9g20_2mmc_nandflash_linuxkernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_NANDFLASH=Y
+set JUMP_ADDR=0x22000000
+set IMG_ADDRESS=0x200000
+set IMG_SIZE=0x200000
+set CONFIG_LOAD_LINUX=Y
+set OS_MEM_BANK=0x20000000
+set OS_MEM_SIZE=0x4000000
+set MACH_TYPE=0x658
+goto :build
+
+:9g20_2mmc_nandflash_gettingstarted
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_NANDFLASH=Y
+set JUMP_ADDR=0x20000000
+set IMG_ADDRESS=0x20000
+set IMG_SIZE=0x40000
+goto :build
+
+:9g20_2mmc_sdcard_eboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_SDCARD=Y
+set JUMP_ADDR=0x20000000
+set CONFIG_LOAD_EBOOT=Y
+goto :build
+
+:9g20_2mmc_sdcard_cekernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_SDCARD=Y
+set JUMP_ADDR=0x20067000
+set CONFIG_LOAD_NK=Y
+goto :build
+
+:9g20_2mmc_sdcard_uboot
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_SDCARD=Y
+set JUMP_ADDR=0x23F00000
+set CONFIG_LOAD_UBOOT=Y
+goto :build
+
+:9g20_2mmc_sdcard_linuxkernel
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_SDCARD=Y
+set JUMP_ADDR=0x22000000
+set CONFIG_LOAD_LINUX=Y
+set OS_MEM_BANK=0x20000000
+set OS_MEM_SIZE=0x4000000
+set MACH_TYPE=0x658
+goto :build
+
+:9g20_2mmc_sdcard_gettingstarted
+set CONFIG_AT91SAM9G20EK_2MMC=Y
+set AT91SAM9G20=Y
+set CONFIG_SDCARD=Y
+set JUMP_ADDR=0x20000000
+goto :build
+
 :9g45_dataflash_eboot
 set CONFIG_AT91SAM9G45EK=Y
 set AT91SAM9G45=Y
@@ -1514,4 +1661,4 @@ cd ..\..
 build -c
 cd wince\buildscripts
 
-:EOF
\ No newline at end of file
+:EOF
diff --git a/wince/image/sources b/wince/image/sources
index 36949ed..524a28f 100644
--- a/wince/image/sources
+++ b/wince/image/sources
@@ -69,6 +69,11 @@ CDEFINES=$(CDEFINES) -DCONFIG_AT91SAM9G20EK
 CDEFINES=$(CDEFINES) -DCONFIG_SDRAM
 CDEFINES=$(CDEFINES) -DGLBDRV_ADDR=0x20058000
 !ENDIF
+!IF ("$(CONFIG_AT91SAM9G20EK_2MMC)" == "Y")
+CDEFINES=$(CDEFINES) -DCONFIG_AT91SAM9G20EK_2MMC
+CDEFINES=$(CDEFINES) -DCONFIG_SDRAM
+CDEFINES=$(CDEFINES) -DGLBDRV_ADDR=0x20058000
+!ENDIF
 !IF ("$(AT91SAM9G20)" == "Y")
 CDEFINES=$(CDEFINES) -DAT91SAM9G20
 ADEFINES=$(ADEFINES) -predefine "BOOTLOADER_STACK_BASE SETA 0x00303FFC"
@@ -114,6 +119,9 @@ CDEFINES=$(CDEFINES) -DAT91C_SPI_PCS_DATAFLASH=0xE
 !IF ("$(CONFIG_AT91SAM9G20EK)" == "Y")
 CDEFINES=$(CDEFINES) -DAT91C_SPI_PCS_DATAFLASH=0xD
 !ENDIF
+!IF ("$(CONFIG_AT91SAM9G20EK_2MMC)" == "Y")
+CDEFINES=$(CDEFINES) -DAT91C_SPI_PCS_DATAFLASH=0xD
+!ENDIF
 !IF ("$(CONFIG_AT91SAM9260EK)" == "Y")
 CDEFINES=$(CDEFINES) -DAT91C_SPI_PCS_DATAFLASH=0xD
 !ENDIF
@@ -173,6 +181,7 @@ INCLUDES=..\..\include; \
          ..\..\board\at91sam9rlek; \
          ..\..\board\at91sam9g10ek; \
          ..\..\board\at91sam9g20ek; \
+         ..\..\board\at91sam9g20ek_2mmc; \
          ..\..\board\at91sam9g45ek; \
          ..\..\board\at91sam9m10ek; \
          ..\..\board\at91sam9g45ekes; \
@@ -188,6 +197,7 @@ TARGETLIBS= \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9rlek.lib \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9g10ek.lib \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9g20ek.lib \
+    $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9g20ek_mmc.lib \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9g45ek.lib \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9m10ek.lib \
     $(_TARGETPLATROOT)\lib\$(_CPUDEPPATH)\at91sam9g45ekes.lib \
-- 
1.7.5.4

